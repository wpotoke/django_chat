{% extends "base.html" %}
{% load static %}

{% block css %}
<link rel="stylesheet" href="{% static 'css/profile_detail.css' %}">
<style>
    /* Стили для particles фона */
    #particles-js {
        position: fixed;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        z-index: -1;
    }
    
    .profile-container {
        position: relative;
        z-index: 1;
    }
</style>
{% endblock %}

{% block title %}{{title}}{% endblock %}

{% block content %}
<!-- Particles фон -->
<div id="particles-js"></div>

<!-- Основной контент -->
<div class="profile-container">
    <div class="profile-header">
        <div class="profile-background"></div>
        <div class="profile-avatar">
            <img src="{{profile.avatar.url}}" alt="{{ profile }}">
        </div>
    </div>
    <div class="profile-info">
        <h1>{{profile.first_name}} {{profile.last_name}}</h1>
        <p class="phone">
            {% if profile.user.phone_number %}
                Телефон {{profile.user.phone_number}}
            {% else %}
                Телефон не указан
            {% endif %}
        </p>
        <p class="username">username @{{profile.user.username}}</p>
        <p class="bio">О себе {{profile.bio}}</p>
        <div class="profile-field">
            <label class="field-label">Дата рождения</label>
            <div class="field-value">
                {% if profile.birthday %}
                    <span class="birthday-badge">{{ profile.birthday|date:"d.m.Y" }}</span>
                {% else %}
                    Не указана
                {% endif %}
            </div>
        </div>
    </div>
    <div class="profile-actions">
        {% if user.profile.slug != profile.slug %}
            <a href="{% url "private_chat" private_chat_uuid %}">
                <button class="btn-message">Написать</button>
            </a>
        {% else %}
            <form action="{% url 'profile_update' %}" method="post" style="display: inline;">
                {% csrf_token %}
                <button type="submit" class="btn-edit">Редактировать</button>
            </form>
            <form action="{% url 'logout' %}" method="post" style="display: inline;">
                {% csrf_token %}
                <button type="submit" class="btn-edit">Выйти</button>
            </form>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block script %}
<script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
<script>
    // Анимация чисел
    function animateValue(id, start, end, duration) {
        let obj = document.getElementById(id);
        let startTimestamp = null;
        const step = (timestamp) => {
            if (!startTimestamp) startTimestamp = timestamp;
            const progress = Math.min((timestamp - startTimestamp) / duration, 1);
            obj.innerHTML = Math.floor(progress * (end - start) + start);
            if (progress < 1) {
                window.requestAnimationFrame(step);
            }
        };
        window.requestAnimationFrame(step);
    }
    animateValue("user-count", 0, 128, 2000);
    animateValue("message-count", 0, 542, 2500);
    // Particles.js
    particlesJS("particles-js", {
        "particles": {
            "number": { "value": 220, "density": { "enable": true, "value_area": 800 } },
            "color": { "value": "#af90e9" },
            "shape": { "type": "star" },
            "opacity": { "value": 0.5, "random": true },
            "size": { "value": 4, "random": true },
            "line_linked": { "enable": true, "distance": 200, "color": "#b23476", "opacity": 0.4, "width": 1 },
            "move": { "enable": true, "speed": 2 }
        },
        "interactivity": {
            "detect_on": "canvas",
            "events": {
                "onclick": { "enable": true, "mode": "push" }
            }
        }
    });
</script>
{% endblock %}