{% extends "base.html" %}
{% load static %}

{% block css %}
<link rel="stylesheet" href="{% static 'css/profile_detail.css' %}">
<link rel="stylesheet" href="{% static 'css/profile_update.css' %}">
<style>
    /* –°—Ç–∏–ª–∏ –¥–ª—è particles —Ñ–æ–Ω–∞ */
    #particles-js {
        position: fixed;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        z-index: -1;
    }
</style>
{% endblock %}

{% block title %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è{% endblock %}

{% block content %}
<!-- Particles —Ñ–æ–Ω -->
<div id="particles-js"></div>

<!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
<div class="profile-container">
    <div class="profile-form">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –∞–≤–∞—Ç–∞—Ä–æ–º -->
        <div class="form-header">
            <div class="form-avatar">
                <img src="{{ form.instance.avatar.url }}" alt="–¢–µ–∫—É—â–∏–π –∞–≤–∞—Ç–∞—Ä" id="avatar-preview">
            </div>
            <h2 class="form-title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è</h2>
        </div>
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            
            <!-- –°–µ–∫—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
            <div class="form-section">
                <h4>üì± –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h4>
                
                <div class="form-group">
                    <label for="id_username" class="form_label">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                    <input type="text" name="username" id="id_username" class="form-control" 
                           value="{{user_form.instance.username}}"
                           placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
                    {% for error in user_form.username.errors %}
                        {% if error != "This field is required." %}
                            <span class="text-danger">{{ error }}</span>
                        {% endif %}
                    {% endfor %}
                </div>
                
                <div class="form-group">
                    <label for="id_phone_number" class="form_label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                    <input type="text" name="phone_number" id="id_phone_number" class="form-control" 
                           value="{{ user_form.instance.phone_number|default:'' }}" 
                           placeholder="+7 (XXX) XXX-XX-XX">
                    {% for error in user_form.phone_number.errors %}
                        {% if error != "This field is required." %}
                            <span class="text-danger">{{ error }}</span>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
            
            <!-- –°–µ–∫—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª—è -->
            <div class="form-section">
                <h4>üë§ –î–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è</h4>
                
                <div class="form-group">
                    <label for="id_first_name" class="form_label">–ò–º—è</label>
                    <input type="text" name="first_name" id="id_first_name" class="form-control" 
                           value="{{ form.instance.first_name}}" 
                           placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è">
                    {% for error in form.first_name.errors %}
                        {% if error != "This field is required." %}
                            <span class="text-danger">{{ error }}</span>
                        {% endif %}
                    {% endfor %}
                </div>
                
                <div class="form-group">
                    <label for="id_last_name" class="form_label">–§–∞–º–∏–ª–∏—è</label>
                    <input type="text" name="last_name" id="id_last_name" class="form-control" 
                           value="{{ form.instance.last_name}}" 
                           placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à—É —Ñ–∞–º–∏–ª–∏—é">
                    {% for error in form.last_name.errors %}
                        {% if error != "This field is required." %}
                            <span class="text-danger">{{ error }}</span>
                        {% endif %}
                    {% endfor %}
                </div>
                
                <div class="form-group">
                    <label for="id_bio" class="form_label">–û —Å–µ–±–µ</label>
                    <textarea name="bio" id="id_bio" class="form-control" rows="3" 
                              placeholder="–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ —Å–µ–±–µ...">{{ form.instance.bio|default:'' }}</textarea>
                    {% for error in form.bio.errors %}
                        {% if error != "This field is required." %}
                            <span class="text-danger">{{ error }}</span>
                        {% endif %}
                    {% endfor %}
                </div>
                
                <div class="form-group">
                    <label for="id_birthday" class="form_label">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
                    <input type="date" name="birthday" id="id_birthday" class="form-control" 
                           value="{{ form.instance.birthday|date:'Y-m-d'|default:'' }}">
                    {% for error in form.birthday.errors %}
                        {% if error != "This field is required." %}
                            <span class="text-danger">{{ error }}</span>
                        {% endif %}
                    {% endfor %}
                </div>
                
                <div class="form-group">
                    <label class="form_label">–°–º–µ–Ω–∞ –∞–≤–∞—Ç–∞—Ä–∞</label>
                    <div class="file-upload-section">
                        <div class="file-input-wrapper">
                            <label for="id_avatar" class="file-input-label">
                                üìÅ –í—ã–±–µ—Ä–∏—Ç–µ –Ω–æ–≤—ã–π –∞–≤–∞—Ç–∞—Ä
                            </label>
                            <input type="file" name="avatar" id="id_avatar" accept="image/*">
                        </div>
                        <div class="file-hint">–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–∑–º–µ—Ä: 300x300 px</div>
                        {% for error in form.avatar.errors %}
                            {% if error != "This field is required." %}
                                <span class="text-danger">{{ error }}</span>
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>
            </div>
            
            <div class="form-actions">
                <button type="submit" class="btn-save">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <a href="{% url 'profile_detail' slug=user.profile.slug %}" class="btn-cancel">‚ùå –û—Ç–º–µ–Ω–∞</a>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block script %}
<script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
<script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è particles.js
    document.addEventListener('DOMContentLoaded', function() {
        particlesJS("particles-js", {
            "particles": {
                "number": { "value": 120, "density": { "enable": true, "value_area": 800 } },
                "color": { "value": "#af90e9" },
                "shape": { "type": "circle" },
                "opacity": { "value": 0.5, "random": true },
                "size": { "value": 3, "random": true },
                "line_linked": { "enable": true, "distance": 150, "color": "#b23476", "opacity": 0.4, "width": 1 },
                "move": { "enable": true, "speed": 2 }
            },
            "interactivity": {
                "detect_on": "canvas",
                "events": {
                    "onhover": { "enable": true, "mode": "repulse" },
                    "onclick": { "enable": true, "mode": "push" }
                }
            }
        });
    });

    // –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∞–≤–∞—Ç–∞—Ä–∞
    document.getElementById('id_avatar').addEventListener('change', function(event) {
        const input = event.target;
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('avatar-preview').src = e.target.result;
            };
            reader.readAsDataURL(input.files[0]);
        }
    });
</script>
{% endblock %}